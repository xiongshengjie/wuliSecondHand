<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0">
	<link rel="stylesheet" type="text/css" href="http://cdn.static.runoob.com/libs/bootstrap/3.3.7/css/bootstrap.min.css">
	<link rel="stylesheet" href="../css/weui.min.css"/>
	<link rel="stylesheet" type="text/css" href="../css/main.css">
    <script src="http://libs.baidu.com/jquery/1.9.1/jquery.js"></script> 
	<title>我想卖</title>
</head>
<body>
	<!--<div class="head">-->
		<!--<a class="head-return" href="#"><</a>-->
		<!--<span class="title">我想卖</span>-->
	<!--</div>-->
	<div class="main">
    <form id="upform" action="http://localhost:8080/wuliSecondHand/addProduct" method="post" enctype="multipart/form-data">
		<div class="weui-cells weui-cells_form">
			<div class="weui-cell weui-cell-textarea">
            
                <div class="weui-cell__hd">
                 <label class="weui-label" >物品名称</label>
                </div>
                
                <div class="weui-cell__bd">
                 <input id="good_name" type="text" name="title" maxlength="15"  class="weui-textarea  intro-text"  placeholder="请输入名称" />
                 <div id="name_wordnum" class="weui-textarea-counter"><span>0</span>/15</div>
                </div>
                
            </div>
            
			<div class="weui-cell weui-cell-textarea">
            
				<div class="weui-cell__hd">
					<label class="weui-label">物品描述</label>
				</div>
                
				<div class="weui-cell__bd">
					<input id="good_descript" name="description"  maxlength="200" type="text" class="weui-textarea  intro-text"  placeholder="请输入描述" />
					<div id="descript_wordnum" class="weui-textarea-counter"><span>0</span>/200</div>
				</div>
                
			</div>
            
            
			<!--<div class="weui-cell chooice-one">-->
				<!--<span class="glyphicon glyphicon-map-marker"></span>-->
				<!--<a href="">选择校区</a>-->
				<!--<a href="">选择分类</a>-->
			<!--</div>-->
			<div class="weui-cell weui-cell_select">
				<div class="weui-cell__bd">
					<select class="weui-select xiaoqu" name="schoolarea">
						<option selected="" value="校区选择">校区选择</option>
						<option value="南湖">南湖</option>
						<option value="鉴湖">鉴湖</option>
						<option value="东院">东院</option>
						<option value="西院">西院</option>
						<option value="余家头">余家头</option>
					</select>
				</div>
			</div>
			<div class="weui-cell weui-cell_select">
				<div class="weui-cell__bd">
					<select class="weui-select classification" name="category">
						<option selected="" value="分类选择">分类选择</option>
						<option value="电子产品">电子产品</option>
						<option value="二手书籍">二手书籍</option>
						<option value="生活用品">生活用品</option>
						<option value="其他">其他</option>
					</select>
				</div>
			</div>
		</div>
		<div class="weui-cells">
			<div class="weui-cell">
				<div class="weui-cell__bd">
					<div class="weui-uploader">
						<div class="weui-uploader__hd">
							<p class="weui-uploader__title">图片上传</p>
							<div class="weui-uploader__info">0/2</div>
						</div>
						<div class="weui-uploader__bd">
							<ul class="weui-uploader__files" id="uploaderFiles">
								<li id="show_screen_1" class="weui-uploader__file" style="border:1px solid #d9d9d9; background-size:contain;"> <img src="" style="width:79px; height:79px"/></li>
								<!--<li class="weui-uploader__file" style="border:1px solid #999"></li>
								<li class="weui-uploader__file" style="border:1px solid #999"></li>
								<li class="weui-uploader__file weui-uploader__file_status">
									<div class="weui-uploader__file-content">
										<i class="weui-icon-warn"></i>
									</div>
								</li>
								<li class="weui-uploader__file" style="border:1px solid #999;">
								</li>  -->
							</ul>
							<div class="weui-uploader__input-box">
                           		<input id="uploaderInput_1" onChange="changeBG(this)" class="weui-uploader__input" type="file" name="img" multiple>
							</div>
                            
						</div> 
					</div>
				</div>
			</div>
		</div>
		<div class="weui-cells weui-cells_form">
			<div class="weui-cells_checkbox">
				<label class="weui-cell weui-check__label" for="s11">
					<div class="weui-cell__bd">
						<p>是否可刀</p>
					</div>
					<div class="weui-cell__ft">
						<label for="switchCP" class="weui-switch-cp">
							<input id="switchCP" name="isbargain" class="weui-switch-cp__input" type="checkbox" checked="checked">
							<div class="weui-switch-cp__box"></div>
						</label>
					</div>
				</label>
			</div>
			<div class="weui-cell">
				<div class="weui-cell__hd">
					<label class="weui-label">微信</label>
				</div>
				<div class="weui-cell__bd">
					<input class="weui-input" type="text" name="wechat" placeholder="请输入微信">
				</div>
			</div>
			<div class="weui-cell">
				<div class="weui-cell__hd">
					<label class="weui-label">qq</label>
				</div>
				<div class="weui-cell__bd">
					<input class="weui-input" type="number" name="qq" maxlength="11" placeholder="请输入qq">
				</div>
			</div>
			<div class="weui-cell">
				<div class="weui-cell__hd">
					<label class="weui-label">手机号</label>
				</div>
				<div class="weui-cell__bd">
					<input class="weui-input" type="tel" name="telnum" placeholder="请输入手机号">
				</div>
			</div>
			<div class="weui-cell weui-cell_switch">
				<div class="weui-cell__bd">是否愿意以物换物</div>
				<div class="weui-cell__ft">
					<label for="switchCP2" class="weui-switch-cp">
					    <input id="switchCP2" name="ischange" class="weui-switch-cp__input" type="checkbox" checked="checked">
						<div class="weui-switch-cp__box"></div>
					</label>
				</div>
			</div>
		</div>
		<div class="weui-cells weui-cells_form">
			<div class="weui-cell">
				<div class="weui-cell__hd">
					<label class="weui-label">定价</label>
				</div>
				<div class="weui-cell__bd">
					<input class="weui-input" type="number" name="price" placeholder="请输入定价">
				</div>
			</div>
		</div>
		<div style="padding:20px 50%"><input  id="publish_btn" type="button" class="btn"  value="确定" /></div>
        </form>
	</div>
    <script>
	$("#good_name").keyup(function()
	{
		var restword=this.value.length;
		$("#name_wordnum").html("<span>"+restword+"</span>/15");
	})
	$("#good_descript").keyup(function()
	{
		var restword=this.value.length;
		$("#descript_wordnum").html("<span>"+restword+"</span>/200");
	})
	 function changeBG() 
	 { 
	 	if(typeof FileReader == 'undefined')  //浏览器不支持filereader
		{
			
		}
	 	var file = document.getElementById("uploaderInput_1").files[0];  //获取file input里面的file信息
		if(!/image\/\w+/.test(file.type))
		{
			alert("请选择图片！");
			return;
		}
		var reader = new FileReader();
		reader.readAsDataURL(file);  //读入 
		
		reader.onload=function(e)
		{
			$("#show_screen_1 img").attr('src',this.result);
		}	  
    }  
    $("#publish_btn").click(function()
	{
		var good_name_length=$("#good_name").val().length;   //物品名字长度
		var good_descript_length=$("#good_descript").val().length;  //物品描述长度
		var wechat_length=$("[name='wechat']").val().length;   //微信账号
		var qq_length=$("[name='qq']").val().length;  //qq长度
		if(good_name_length<1)
		{
			alert("物品名称未填写！");
			return;
		}
		if(good_descript_length<1)
		{
			alert("物品描述未填写！");
			return;
		}
		//判断图片文件的选择
		var img=$("[name='img']").val();
		var exStart=img.lastIndexOf(".");
		var imgtype=img.substring(exStart,img.length).toUpperCase();
		if(img=="")
		{
			alert("请选择图片文件！");
			return;
		}
		if(imgtype!=".BMP"&&imgtype!=".PNG"&&imgtype!=".GIF"&&imgtype!=".JPG"&&imgtype!=".JPEG")
		{
			alert("请正确选择图片文件！图片限于png,gif,jpeg,jpg格式");
			return;
		}
		if(wechat_length<1)
		{
			alert("请填写微信账号！");
			return;
		}
		if(qq_length<1)
		{
			alert("请填写qq账号！");
			return;
		}
		//两个checbox判断
		var sc_partten="校区选择";
		var ca_partten="分类选择";
		var sc=$("[name='schoolarea']").val();
		var ca=$("[name='category']").val();
		if(sc_partten==sc)
		{
			alert("请选择校区！");
			return;
		}
		if(ca_partten==ca)
		{
			alert("请选择分类!");
			return;
		}
		//判断电话号码
		var cell_partten = /^1[3,5,8]\d{9}$/;
		var partten = /^0(([1,2]\d)|([3-9]\d{2}))\d{7,8}$/;
		var phone_num=$("[name='telnum']").val();
		if(!(cell_partten.test(phone_num)||partten.test(phone_num)))
		{
			alert("电话格式不正确!");
			return;
		}
		//价格判断
		var price_length=$("[name='price']").val().length;
		if(price_length<1)
		{
			alert("请输入物品价格！")
			return;
		}
		
		var form = new FormData(document.getElementById("upform"));
		$.ajax({
			url:"http://localhost:8080/wuliSecondHand/addProduct",         //请求地址
			type: "POST",                       //请求方式
			data:form,              //请求参数
			dataType: "json",
			processData:false,
	        contentType:false,
			success: function(data) 
			{
				var json=eval(data);
				if(json.errCode==0)
				{
					alert(json.errMsg);
					window.location.href="http://wulikm.cn/wuliSecondHand/index.html";
				}
				if(json.errCode==1)
				{
					alert(json.errMsg);
				}
			},
			fail: function (status) 
			{
				alert("失败");
			}
		});
    })
	
	</script>
</body>

</html>
